<div class="cookie-alert{% if close %} cookie_alert_close{% endif %}{% if allow %} cookie_alert_allow{% endif %} cookie_alert_2" id="cookie_alert"
     role="region" aria-label="{{ text.cookie_consent_settings }}" aria-describedby="cookie_alert_description" tabindex="-1"
>
    <div class="cookie-alert__inner py-4 border-top" id="cookie_alert_open">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-lg-8 col-xl-9 mb-2 mb-md-0">
                    <div id="cookie_alert_title" class="cookie-alert__title font-weight-bold">{{ text.cookie_consent_settings }}</div>
                    <div id="cookie_alert_description" class="cookie-alert__text font-s">{{ text.cookie_consent_text_1 }}</div>
                    {% if consent_date %}
                    <div class="cookie-alert__consent-data mt-3">
                        {% if consent_date %}<div>{{ text.cookie_consent_date }}: <b>{{ consent_date }}</b></div>{% endif %}
                        {% if consent_id %}<div>{{ text.cookie_consent_id }}: <b>{{ consent_id }}</b></div>{% endif %}
                    </div>
                    {% endif %}
                </div>
                <div class="col-md-6 col-lg-4 col-xl-3">
                    <div class="cookie-alert__checkboxes form-group">
                        <div class="custom-control custom-checkbox">
                            <input class="custom-control-input" type="checkbox" id="cookie_alert_checkbox_working" checked="checked" disabled="disabled" />
                            <label for="cookie_alert_checkbox_working" class="custom-control-label">{{ text.functional_cookies }}</label>
                        </div>
                        <div class="custom-control custom-checkbox">
                            <input class="custom-control-input" type="checkbox" id="cookie_alert_checkbox_plus"{% if checkbox_marketing_checked %} checked="checked"{% endif %} value="1" />
                            <label for="cookie_alert_checkbox_plus" class="custom-control-label">{{ text.other_cookies }}</label>
                        </div>
                    </div>
                    <div class="cookie-alert__btn-set-wrap text-center text-md-left">
                        <button class="cookie-alert__btn-set btn btn-primary icon--a-check" type="button" onclick="cookie_alert_action(1,(($('#cookie_alert_checkbox_plus').prop('checked')==true)?1:0));">{{ text.button_set }}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            $(".cookie-alert__btn-open").show();

            function consentFocusHandling() {
                const $overlay = $('#cookie_alert');
                const $focusableElements = $overlay.find('button, input:not([disabled]), a[href]:not([href="#"]):not(.close)');

                if ($focusableElements.length === 0) {
                    return;
                }

                const $firstElement = $focusableElements.first();
                const $lastElement = $focusableElements.last();

                $overlay.off('keydown.focustrap').on('keydown.focustrap', function(event) {
                    if (event.key === 'Tab' || event.keyCode === 9) {
                        if (event.shiftKey) {
                            if (document.activeElement === $firstElement[0] || document.activeElement === $overlay[0]) {
                                event.preventDefault();
                                $lastElement.focus();
                            }
                        } else {
                            if (document.activeElement === $lastElement[0]) {
                                event.preventDefault();
                                $firstElement.focus();
                            }
                        }
                    }
                });
                window.announceToScreenReader?.('modalOpen',{'label': `{{ text.cookie_consent_settings }}`});
                setTimeout(function () {
                    $overlay.focus();
                }, 1000);
            }

            {% if not close %}
            consentFocusHandling();
            {% endif %}

            $(document).on("openConsent", function () {
                consentFocusHandling();
            });
            $(document).on("closeConsent", function () {
                window.announceToScreenReader?.('modalClose',{'label': `{{ text.cookie_consent_settings }}`});
            });
            $(document).on("grantConsent", function () {
                window.announceToScreenReader?.('grantConsent');
            });
            $(document).on("rejectConsent", function () {
                window.announceToScreenReader?.('rejectConsent');
            });
        });
    </script>
</div>