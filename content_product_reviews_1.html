{% if upload_review_images %}
<link rel="preload" href="[unas_service_url_base]/!common_packages/jquery/plugins/photoswipe/css/default-skin.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<link rel="preload" href="[unas_service_url_base]/!common_packages/jquery/plugins/photoswipe/css/photoswipe.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<script defer src="[unas_service_url_base]/!common_packages/jquery/plugins/photoswipe/photoswipe.min.js" type="text/javascript"></script>
<script defer src="[unas_service_url_base]/!common_packages/jquery/plugins/photoswipe/photoswipe-ui-default.min.js" type="text/javascript"></script>
{% endif %}

<div id="page_artforum_content" class="page--product-reviews page_content product-reviews--type-1">
    <div class="container container-max-xl">
    {% if reviews_disp %}
        {{ script }}

        {% if already_reviewed %}
        <div class="product-reviews__title-wrap mb-5">
            <a href="{{ back_url }}" title="{{ product_name }}">
                <h1 class="product-reviews__title main-title mb-0 text-center">{{ product_name }}</h1>
            </a>
            <div class="product-reviews__subtitle text-center font-l">{{ text.reviews_about_product }}</div>
        </div>
        <div class="product-reviews__review main-block">
            {% include common_vars.layout_urls.embed_product_reviews_head_1 %}

            {% if paging_disp %}
            <nav class="product-reviews-paging paging--top d-flex align-items-center justify-content-center py-1 py-md-3 border-bottom border-top" aria-label="{{ text.top ~ ' ' ~ text.pagination ~ ': ' ~ text.reviews ~ ' ' ~ text.list }}">
                {{ paging_content }}
            </nav>
            {% endif %}

            {% include common_vars.layout_urls.embed_product_reviews_1 %}

            {% if paging_disp %}
            <nav class="product-reviews-paging paging--bottom d-flex align-items-center justify-content-center py-1 py-md-3 mb-5 border-top border-bottom" aria-label="{{ text.bottom ~ ' ' ~ text.pagination ~ ': ' ~ text.reviews ~ ' ' ~ text.list }}">
                {{ paging_content }}
            </nav>
            {% endif %}
        </div>
        {% endif %}

        <div class="writing-review__title main-title text-center">{{ text.write_review_about_product }}</div>
        <div class="writing-review__container container-max-md px-0">
            <div class="writing-review my-5">
                <div class="writing-review__product-pic-name-wrap row no-gutters mb-4 align-items-center">
                    {% if product_img_disp %}
                    <div class="writing-review__product-pic-wrap col-auto">
                        <a href="{{ back_url }}" title="{{ product_name }}">
                            <img width="{{ backvar.product_img_width }}" height="{{ backvar.product_img_height }}" src="{{ product_img_url }}"{% if product_img_retina_exists %} srcset="{{ product_img_retina_url }} {{ product_img_retina_size }}"{% endif %} alt="{{ product_img_alt }}" title="{{ product_img_title }}" id="{{ product_img_id }}" />
                        </a>
                    </div>
                    {% endif %}

                    <div class="writing-review__product-name-wrap col pl-4">
                        <a href="{{ back_url }}">
                            {% if already_reviewed %}
                                <div class='writing-review__product-name font-weight-bold'>{{ product_name }}</div>
                            {% else %}
                                <h1 class='writing-review__product-name font-weight-bold font-m mb-0'>{{ product_name }}</h1>
                            {% endif %}
                        </a>
                    </div>
                </div>

                {{ form_start }}
                {% if login_needed and (not only_verified_customer_can_write_opinion and not only_verified_registered_customer_can_write_opinion) %}
                    <div class="writing-review__info my-4">{{ text.only_registered_customer_can_write_opinion }}</div>
                {% endif %}
                {% if only_verified_customer_can_write_opinion or only_verified_registered_customer_can_write_opinion %}
                    <div class="writing-review__verification-info my-4">{{ who_can_write_review_info_text }}</div>
                {% endif %}

                <div class="writing-review__form-inner">
                    <div class="form-row">
                        <div class="col-sm">
                            <div class="form-group">
                                <label for="forum_name" {% if login_needed %}class="fixed"{% endif %}>{{ text.name }}</label>
                                <input class="form-control{% if author_name_error_disp %} is-invalid{% endif %}{% if author_name!= '' %} fixed{% endif %}" name="forum_name" placeholder="{{ text.name }}" id="forum_name" type="text" maxlength="100" value="{{ author_name }}"/>
                                <div class="invalid-feedback">{{ text.error_required }}</div>
                            </div>
                        </div>
                        {% if author_email_disp %}
                        <div class="col-sm">
                            <div class="form-group">
                                <label for="forum_emai" {% if login_needed %}class="fixed"{% endif %}>{{ text.email }}</label>
                                <input class="form-control{% if author_email_error_disp %} is-invalid{% endif %}{% if author_email!= '' %} fixed{% endif %}" name="forum_emai" placeholder="{{ text.email }}" id="forum_emai" type="email" maxlength="100" {% if login_needed %}readonly="1"{% endif %} value="{{ author_email }}"/>
                                <div class="invalid-feedback">{{ author_email_error_text }}</div>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <div class="form-group mb-4" id="page_artforum_write_score">
                        <div class="writing-review__score d-flex align-items-baseline">
                            <div class="writing-review__score-label mr-3">{{ text.rating }}:</div>
                            <div class="writing-review__score-value">
                                <div class="writing-review__stars stars flex-row-reverse">
                                    <input id="rating-5" class="form-control star-radio" name="forum_score" type="radio" value="5" {% if posted_score == 5 %}checked="checked"{% endif %}/>
                                    <label for="rating-5" class="star-label star star--empty"></label>
                                    <input id="rating-4" class="form-control star-radio" name="forum_score" type="radio" value="4" {% if posted_score == 4 %}checked="checked"{% endif %}/>
                                    <label for="rating-4" class="star-label star star--empty"></label>
                                    <input id="rating-3" class="form-control star-radio" name="forum_score" type="radio" value="3" {% if posted_score == 3 %}checked="checked"{% endif %}/>
                                    <label for="rating-3" class="star-label star star--empty"></label>
                                    <input id="rating-2" class="form-control star-radio" name="forum_score" type="radio" value="2" {% if posted_score == 2 %}checked="checked"{% endif %}/>
                                    <label for="rating-2" class="star-label star star--empty"></label>
                                    <input id="rating-1" class="form-control star-radio" name="forum_score" type="radio" value="1" {% if posted_score == 1 %}checked="checked"{% endif %}/>
                                    <label for="rating-1" class="star-label star star--empty"></label>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" class="form-control{% if posted_score_error_disp %} is-invalid{% endif %}" name="feedback" value="0">
                        <div class="invalid-feedback">{{ text.error_required }}</div>
                    </div>

                    <div class="form-group">
                        <label for="forum_message">{{ text.message }}</label>
                        <textarea class="form-control{% if message_error_disp %} is-invalid{% endif %}" name="forum_message" placeholder="{{ text.message }}" id="forum_message" rows="" cols="">{{ posted_message }}</textarea>
                        <div class="invalid-feedback">{{ text.error_required }}</div>
                    </div>

                    {% if pro_con_disp %}
                    <div class="form-row">
                        <div class="col-sm">
                            <div class="form-group">
                                <label for="forum_message_pros">{{ text.advantages }}</label>
                                <textarea class="form-control{% if pro_error_disp %} is-invalid{% endif %}" name="forum_message_pros" placeholder="{{ text.advantages }}" id="forum_message_pros" rows="" cols="">{{ posted_pro }}</textarea>
                                <div class="invalid-feedback">{{ text.error_required }}</div>
                            </div>
                        </div>
                        <div class="col-sm">
                            <div class="form-group">
                                <label for="forum_message_cons">{{ text.disadvantages }}</label>
                                <textarea class="form-control{% if con_error_disp %} is-invalid{% endif %}" name="forum_message_cons" placeholder="{{ text.disadvantages }}" id="forum_message_cons" rows="" cols="">{{ posted_con }}</textarea>
                                <div class="invalid-feedback">{{ text.error_required }}</div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if upload_review_images %}
                    <script>
                        var fileUploader = new reviewFileUploader('{{ product_sku }}');
                        fileUploader.init();
                    </script>

                    <input type="hidden" name="review_image_random" id="review_image_random" value="{{ review_image_random }}">

                    <fieldset id="page_artforum_upload_images" class="writing-review__image-upload-group form-group">
                        <legend class="writing-review__image-upload-title form-label">{{ text.images }}</legend>
                        <div class="writing-review__image-upload-images js-review-images row gutters-10 row-gap-20">
                            {% for imageNumber in range(1,3) %}
                                <div class="writing-review__image-upload-wrapper js-review-image-{{ imageNumber}} col-sm-6 col-md-4">
                                    <div class="writing-review__image-delete js-review-image-delete {% if not _context['review_image_old_url_' ~ imageNumber ~ '_disp'] %}d-none{% endif %}" data-image-number="{{ imageNumber}}"></div>
                                    <div class="writing-review__image-upload-outer js-review-image-upload-outer" data-image-number="{{ imageNumber}}">
                                        <label for="review-images-file-upload-{{ imageNumber }}" class="writing-review__image-upload js-review-image-upload {% if _context['review_image_old_url_' ~ imageNumber ~ '_disp'] %}d-none{% endif %}"></label>
                                        <input id="review-images-file-upload-{{ imageNumber }}" type="file" name="review_image" class="d-none" onchange="fileUploader.upload({{ imageNumber }});">
                                        <div class="writing-review__image-wrapper js-review-image-wrapper p-3 {% if not _context['review_image_old_url_' ~ imageNumber ~ '_disp'] %}d-none{% endif %}">
                                            <div class="loading-spinner {% if _context['review_image_old_url_' ~ imageNumber ~ '_disp'] %}d-none{% endif %}"></div>
                                            <div class="js-review-image-content">
                                                {% if _context['review_image_old_url_' ~ imageNumber ~ '_disp'] %}
                                                    <img src="{{ _context['review_image_old_url_' ~ imageNumber] }}" alt="">
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="writing-review__error-text js-review-image-errors text-danger font-xs d-none"></div>
                                </div>
                            {% endfor %}
                        </div>
                    </fieldset>
                    {% endif %}

                    <div class="form-group" id="writing-review__policy">
                        <div class="custom-control custom-checkbox font-s">
                            <input class="custom-control-input{% if pp_error_disp %} is-invalid{% endif %}" name="forum_privacy_policy" id="forum_privacy_policy" type="checkbox" value="1" {% if pp_accepted %}checked="checked"{% endif %}/>
                            <label class="custom-control-label" for="forum_privacy_policy">{{ text.accept_privacy_policy }}</label>
                            <div class="invalid-feedback">{{ text.error_privacy_policy }}</div>
                        </div>
                    </div>

                    <div class="form-group text-center" id="reviews__btn-wrap">
                    {% if recaptcha_disp %}
                        {{ recaptcha_script }}
                        <button class="reviews__btn g-recaptcha btn btn-primary" {{ recaptcha_attributes }}>{{ text.button_send }}</button>
                    {% else %}
                        <button name="button" class="reviews__btn btn btn-primary" type="button" onclick="{{ button_onclick_value }}">{{ text.button_send }}</button>
                    {% endif %}
                    </div>
                </div>
                {{ form_end }}
            </div>
            <a class="product-reviews__btn-back btn btn--back" href="{{ back_url }}#artdet__product-reviews">{{ text.button_back }}</a>
        </div>
    {% endif %}
    </div>
</div>